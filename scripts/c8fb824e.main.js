"use strict";function getSkippedDays(){var a=[];return $("#skip-checkboxes input:checked").each(function(b,c){a.push(c.value)}),a}function showError(a){var b='<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>'+a+"</strong></div>";$("#wait").hide(),$("div .alert").remove(),$("#wait").parent().append(b),document.getElementById("wait").scrollIntoView()}function getPlannerData(){var a={};if(a.sequenceName=$(".list-group-item.active").attr("name"),!a.sequenceName)throw"Choose a sequence.";if(a.begin=$("#calendar-start").datepicker("getDate"),a.begin[0])throw"Choose a start date.";if(a.end=$("#calendar-end").datepicker("getDate"),a.end[0])throw"Choose an end date.";var b=[];if($("#skip-checkboxes input:checked").each(function(a,c){b.push(Number(c.value))}),a.skip=b,a.type=$("#type :radio:checked").attr("id"),a.amount="specified"===a.type?$("#amountSpecified :radio:checked").attr("id"):$("#amountNumber").val(),!a.type)throw"Choose an amount to read.";if("verses"===a.type&&!a.amount)throw"Specify the number of verses per day you want to read.";if("specified"===a.type&&!a.amount)throw"Choose to whether or not to read the whole plan or just what fits in your days.";return console.info("Data "+JSON.stringify(a)),a}function output(a,b){switch(b){case"pdf":case"text":case"markdown":case"ical":console.error("Not implemented yet.");break;case"dom":for(var c="",d=0;d<a.length;d++){c=c+"<tr><td>"+a[d].day+"</td><td>";for(var e=0;e<a[d].refs.length;e++)if("string"==typeof a[d].refs[e])c+=a[d].refs[e],e<a[d].refs.length-1&&(c+=", ");else for(var f=0;f<a[d].refs[e].length;f++)c+=a[d].refs[e][f],f<a[d].refs[e].length-1&&(c+=", ");c+="</td></tr>"}return c}}console.groupCollapsed("App tests"),console.log("Running jQuery %s",$().jquery),console.log(bible);var ref=bible.parseReference("rom 1:4");console.log(bible.add(ref,10).toString()),console.groupEnd();var READING_PLANS="khornberg.github.io"===window.location.host?"http://khornberg.github.io/bible-reading-planner/bower_components/readingplans":"bower_components/readingplans",FILENAME="BibleReadingPlan",SEPARATOR=-1!==navigator.appVersion.indexOf("Win")?"\r\n":"\n";$(".list-group-item").click(function(){$(".list-group-item").each(function(){$(this).removeClass("active")}),$(this).addClass("active"),planner.sequenceName=$(".list-group-item.active").attr("name"),planner.load();var a="<p><b>Day 1:</b> "+planner.sequence.data2[0],b="<br /><b>Day 2:</b> "+planner.sequence.data2[1]+"</p>",c="<p><b>Days:</b> "+planner.sequence.data2.length+"<br /><b>Readings:</b> "+planner.sequence.data.length,d=planner.sequence.info+"<br /><br />Excerpt from the original sequence:"+a+b+c;$(".panel-sequence").html(d)}),$("#calendar-start").datepicker({todayHighlight:!0,startDate:new Date}),$("#calendar-start").datepicker("update",new Date),$("#calendar-end").datepicker({todayHighlight:!0,startDate:new Date});var initEndDate=new Date;initEndDate.setDate(initEndDate.getDate()+30),$("#calendar-end").datepicker("update",initEndDate),$("#calendar-start").change(function(){$("#calendar-end").datepicker("setStartDate",$("#calendar-start").datepicker("getDate"))}),$("#calendar-end").change(function(){$("#calendar-start").datepicker("setEndDate",$("#calendar-end").datepicker("getDate"))}),$("#skip-checkboxes").change(function(){$("#calendar-start").datepicker("setDaysOfWeekDisabled",getSkippedDays()),$("#calendar-end").datepicker("setDaysOfWeekDisabled",getSkippedDays())}),$("#type input[type=radio]").change(function(){"specified"===this.id?($("#amountNumber").hide(),$("#amountSpecified").show()):($("#amountNumber").show(),$("#amountSpecified").hide())}),$("#sequence").click(function(a){a.preventDefault()}),$("#legal").click(function(a){a.preventDefault(),$(".legal").toggle(),document.getElementById("legal").scrollIntoView()}),$("#create").click(function(){try{$(".alert").remove();var a=getPlannerData();planner.set(a),planner.create();var b=output(planner.plan,"dom");b&&$("tbody").children().remove(),$("tbody").append(b),$(".plan").addClass("fade"),document.getElementById("plan").scrollIntoView()}catch(c){console.error(c),404===c.status?showError("Error getting the plan file."):showError(c)}}),$("#save").click(function(a){a.preventDefault(),$(".save a").toggle()}),$("#share").click(function(a){a.preventDefault(),$(".share a").toggle()}),$("#downloadText").click(function(a){a.preventDefault();var b="";$("tbody tr").each(function(a,c){b+=c.cells[0].innerText+": "+c.cells[1].innerText+SEPARATOR});var c=new Blob([b],{type:"text/plain;charset=utf-8"});saveAs(c,FILENAME+".txt")}),$("#downloadMarkdown").click(function(a){a.preventDefault();var b="";$("tbody tr").each(function(a,c){b+="**"+c.cells[0].innerText+"**: "+c.cells[1].innerText+SEPARATOR});var c=new Blob([b],{type:"text/plain;charset=utf-8"});saveAs(c,FILENAME+".md")}),$("#downloadIcs").click(function(a){a.preventDefault();var b=ics();$("tbody tr").each(function(a,c){var d=moment(c.cells[0].innerText,"MMMM DD, YYYY"),e=moment(d).format("YYYY/MM/DD"),f=moment(d).add("d",1).format("YYYY/MM/DD"),g=c.cells[1].innerText,h="Bible Reading",i="Your Bible";b.addEvent(h,g,i,e,f)}),b.download(FILENAME)}),$("#emailText").click(function(){var a="";$("tbody tr").each(function(b,c){a+=c.cells[0].innerText+": "+c.cells[1].innerText+SEPARATOR}),console.log(a),$("#emailText").attr("href","mailto:?Subject=Bible Reading Plan&Body="+a)});var planner={sequence:null,sequenceName:null,begin:null,end:null,skip:null,amount:null,type:null,duration:null,plan:null,create:function(){if("verses"===this.type){var a=Number(this.amount)>0?Number(this.amount):1;this.plan=this.createVersesPlan(this.sequence,a)}"specified"===this.type&&(this.plan=this.createSpecifiedPlan(this.sequence,this.amount))},createSpecifiedPlan:function(a,b){var c=Math.floor(a.data2.length/this.duration.length);c=0===c?1:c;var d=a.data2.length%this.duration.length,e=[],f=0;if("whole"===b)for(var g=0;g<this.duration.length;g++){for(var h=[],i=0;c>i;i++)if(f<a.data2.length){for(var j=0;j<a.data2[f].length;j++)h.push(bible.parseReference(a.data2[f][j]).toString());if(f++,d>0){for(var k=0;k<a.data2[f].length;k++)h.push(bible.parseReference(a.data2[f][k]).toString());f++,d--}}if(e.push({day:this.duration[g].toString(),refs:h}),f===a.data2.length)break}if("partial"===b)for(var l=this.duration.length<a.data2.length?this.duration.length:a.data2.length,m=0;l>m;m++){for(var n="",o=0;o<a.data2[m].length;o++){var p=o>0?", ":"";n+=p+bible.parseReference(a.data2[m][o]).toString()}e.push({day:this.duration[m].toString(),refs:[n.trim()]})}return e},createVersesPlan:function(a,b){for(var c,d=0,e="",f=[],g=[],h=[],i=0;d<a.data.length;){if((null===c||void 0===c)&&(c=bible.parseReference(a.data[d]),c.chapter1>=0&&-1===c.verse1&&-1===c.verse2)){c.chapter2=-1===c.chapter2?c.chapter1:c.chapter2;var j=-1===c.chapter2?c.chapter1-1:c.chapter2-1;c.verse2=bible.Books[c.bookIndex].verses[j],c.verse1=1}if(c.isValid()){var k=null!==c?bible.distance(c).verses:0,l=i>0?i:b;if(k>=l){var m=-1===c.verse1?1:c.verse1,n=bible.Reference(c.bookIndex,c.chapter1,m),o=n.toString(),p=bible.add(n,l-1),q=p.toString(),r=null;if(o!==q)if(n.bookIndex===p.bookIndex){var s=n.chapter1===p.chapter1?"":p.chapter1+":";r=o+"-"+s+p.verse1}else r=o+"-"+q;else r=o;h.push(r),g.push(h),h=[],bible.add(c,l),(c.chapter1>c.chapter2||c.chapter1===c.chapter2&&c.verse1>c.verse2)&&(console.error("Reversed: "+c),c=null,d++),i=0}else h.push(c.toString()),i=l-k,c=null,d++}else void 0!==a.data[d]&&(console.error("invalid reference: "+a.data[d]+" key: "+d+" sequence: "+a.name),g.push("Sorry there was an error parsing "+a.data[d]+"."),c=null,d++)}""!==e&&g.push(e);for(var t=0;t<this.duration.length;t++)void 0!==g[t]&&f.push({day:this.duration[t],refs:[g[t]]});return f},load:function(){var a=arguments.length>=1?arguments[0]:this.sequenceName,b=arguments.length>=2?arguments[1]:READING_PLANS,c=null;a&&$.ajax({dataType:"json",url:b+"/"+a,async:!1,success:function(a){c=a},error:function(a){throw a}}),this.sequence=c},set:function(a){this.sequenceName=a.sequenceName,this.begin=a.begin,this.end=a.end,this.skip=a.skip,this.amount=a.amount,this.type=a.type,this.duration=time(this.begin,this.end,this.skip),this.load()}},time=function(a,b,c){for(var d=moment(a),e=moment(b),f=d.twix(e,!0),g=f.iterate("days"),h=0,i=[];h<f.count("days");){var j=g.next();c.indexOf(j.day())<0&&i.push(j.format("MMMM Do, YYYY")),h++}return i};